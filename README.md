# 异常概括自动汇总工具 (Exception Summary Automation)

这个工具用于自动化合并、整理和归档每日的业务异常数据。它读取指定目录下的多个业务Excel报表，将其汇总到一个总表中，并根据修复状态自动进行归档。

## 核心功能

1.  **多源数据读取**:
    -   **自营采购退货**: 读取自营退货订单及逆向销售单。
    -   **备件库退货**: 读取备件库退货订单。
    -   **平台零售订单**: 读取销售订单应收、发货通知、销售出库单等。
2.  **数据清洗与合并**:
    -   自动统一列名。
    -   保留并合并历史数据（`异常概括汇总.xlsx`）。
    -   如果存在历史数据，会将新数据按关键列（环节、异常类型、描述等）进行合并。
3.  **自动归档**:
    -   检测“异常修复”列。如果包含“**已修复**”或“**已定位**”，该行数据会被自动移入“**问题归档**”Sheet，不再显示在当前业务Sheet中。
4.  **智能排序与美化**:
    -   **IT异常**优先置顶。
    -   日期列按**倒序排列**（最新的日期显示在最左侧，紧挨固定信息列）。
    -   自动调整Excel行高和列宽，设置自动换行，方便查看。

## 依赖环境

需要 Python 3.x 及以下第三方库：

```bash
pip install pandas openpyxl
```

## 配置说明

脚本中的文件路径目前是硬编码的，使用前请根据实际情况在 `exception_summary.py` 中修改：

```python
# 基础路径
base_path = r"C:\Users\zhangyaolong\Desktop\异常概括"

# 输入文件列表 (示例)
files_self_run = [
    (r"...\每日\自营退货订单项目维度退货单.xlsx", "自营退货订单-项目维度退货单"),
    ...
]
```

## 使用方法

1.  将每日更新的原始报表放入配置指定的文件夹。
2.  运行脚本：
    ```bash
    python exception_summary.py
    ```
3.  脚本运行完成后，会在 `base_path` 下生成或更新 `异常概括汇总.xlsx`。

## 输出文件结构

生成的 `异常概括汇总.xlsx` 包含以下 Sheet：
-   **自营采购退货**
-   **备件库退货**
-   **平台零售订单**
-   **问题归档**: 存放所有已解决的历史问题。
